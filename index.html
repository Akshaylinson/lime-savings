<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Finance Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 p-4">

  <div class="w-full max-w-screen-lg mx-auto bg-white p-4 sm:p-6 rounded-xl shadow-md">
    <h1 class="text-2xl sm:text-3xl font-bold text-center mb-6 text-gray-800">üíº Lime-Finance</h1>

    <!-- Tabs -->
    <div class="flex flex-wrap justify-center mb-6 gap-2">
      <button onclick="showTab('expenseTab')" class="tab-btn bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Income & Expenses</button>
      <button onclick="showTab('savingsTab')" class="tab-btn bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-blue-200">Savings</button>
    </div>

    <!-- Income/Expense Tab -->
    <div id="expenseTab" class="tab-content">
      <div class="flex flex-wrap gap-4 justify-between mb-6">
        <div class="w-full sm:flex-1 bg-green-500 text-white p-4 sm:p-6 rounded-lg text-center font-semibold text-lg">Income: ‚Çπ<span id="totalIncome">0</span></div>
        <div class="w-full sm:flex-1 bg-red-500 text-white p-4 sm:p-6 rounded-lg text-center font-semibold text-lg">Expense: ‚Çπ<span id="totalExpense">0</span></div>
        <div class="w-full sm:flex-1 bg-blue-500 text-white p-4 sm:p-6 rounded-lg text-center font-semibold text-lg">Balance: ‚Çπ<span id="balance">0</span></div>
      </div>

      <form id="entryForm" class="flex flex-wrap gap-4 mb-6">
        <input type="date" id="date" required class="w-full sm:flex-1 px-4 py-2 border rounded-md">
        <select id="type" required class="w-full sm:flex-1 px-4 py-2 border rounded-md">
          <option value="income">Income</option>
          <option value="expense">Expense</option>
        </select>
        <input type="number" id="amount" placeholder="Amount (‚Çπ)" required class="w-full sm:flex-1 px-4 py-2 border rounded-md">
        <input type="text" id="description" placeholder="Description" required class="w-full sm:flex-1 px-4 py-2 border rounded-md">
        <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700">Add Entry</button>
      </form>

      <div class="overflow-x-auto">
        <table class="w-full border-collapse text-sm sm:text-base">
          <thead class="bg-gray-200">
            <tr>
              <th class="px-4 py-2">Date</th>
              <th class="px-4 py-2">Type</th>
              <th class="px-4 py-2">Description</th>
              <th class="px-4 py-2">Amount (‚Çπ)</th>
              <th class="px-4 py-2">Action</th>
            </tr>
          </thead>
          <tbody id="recordsTable" class="text-center"></tbody>
        </table>
      </div>

      <div class="mt-10">
        <h2 class="text-xl text-center font-semibold mb-4 text-gray-700">Monthly Income & Expense Overview</h2>
        <canvas id="incomeExpenseChart" height="100"></canvas>
      </div>
    </div>

    <!-- Savings Tab -->
    <div id="savingsTab" class="tab-content hidden">
      <form id="savingsForm" class="flex flex-wrap gap-4 mb-6">
        <input type="date" id="sDate" required class="w-full sm:flex-1 px-4 py-2 border rounded-md">
        <select id="sType" required class="w-full sm:flex-1 px-4 py-2 border rounded-md">
          <option value="income">Income</option>
          <option value="expense">Expense</option>
        </select>
        <input type="number" id="sAmount" placeholder="Amount" required class="w-full sm:flex-1 px-4 py-2 border rounded-md">
        <input type="text" id="sDesc" placeholder="Description" required class="w-full sm:flex-1 px-4 py-2 border rounded-md">
        <select id="sCategory" required class="w-full sm:flex-1 px-4 py-2 border rounded-md"></select>
        <button type="submit" class="w-full bg-green-600 text-white py-2 rounded-md hover:bg-green-700">Add Entry</button>
      </form>

      <div class="mb-6">
        <button id="settingsBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 mb-4">‚öôÔ∏è Manage Categories</button>
        <div id="settingsPanel" class="hidden border-t pt-4 mt-4">
          <div class="flex flex-wrap gap-4 mb-4">
            <input type="text" id="newCategory" placeholder="New Category" class="w-full sm:w-64 px-4 py-2 border rounded-md">
            <input type="number" id="targetAmount" placeholder="Target ‚Çπ" class="w-full sm:w-64 px-4 py-2 border rounded-md">
            <button onclick="addCategory()" type="button" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Add Category</button>
          </div>
          <div id="categoryList" class="space-y-2 text-gray-700 font-medium"></div>
        </div>
      </div>

      <div id="savingsList" class="space-y-4 mb-10"></div>

      <div class="mt-10">
        <h2 class="text-xl text-center font-semibold mb-4 text-gray-700">Category-wise Monthly Savings</h2>
        <canvas id="categoryChart" height="100"></canvas>
      </div>
    </div>
  </div>

  <!-- JS Script -->
  <script>
    function showTab(tabId) {
      document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
      document.getElementById(tabId).classList.remove('hidden');
    }

    // ---------- Income/Expense Section ----------
    let records = JSON.parse(localStorage.getItem("records")) || [];
    const incomeEl = document.getElementById("totalIncome");
    const expenseEl = document.getElementById("totalExpense");
    const balanceEl = document.getElementById("balance");
    const tableEl = document.getElementById("recordsTable");
    const chartEl = document.getElementById("incomeExpenseChart");
    let chart;

    function updateTableAndSummary() {
      tableEl.innerHTML = "";
      let income = 0, expense = 0;
      records.forEach((rec, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td class="px-4 py-2">${rec.date}</td>
          <td class="px-4 py-2">${rec.type}</td>
          <td class="px-4 py-2">${rec.description}</td>
          <td class="px-4 py-2">‚Çπ${rec.amount}</td>
          <td class="px-4 py-2"><button onclick="deleteRecord(${index})" class="bg-red-500 text-white px-2 py-1 rounded">Delete</button></td>`;
        tableEl.appendChild(row);
        rec.type === "income" ? income += rec.amount : expense += rec.amount;
      });
      incomeEl.textContent = income.toFixed(2);
      expenseEl.textContent = expense.toFixed(2);
      balanceEl.textContent = (income - expense).toFixed(2);
      updateChart();
    }

    document.getElementById("entryForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const entry = {
        date: document.getElementById("date").value,
        type: document.getElementById("type").value,
        amount: parseFloat(document.getElementById("amount").value),
        description: document.getElementById("description").value
      };
      records.push(entry);
      localStorage.setItem("records", JSON.stringify(records));
      this.reset();
      updateTableAndSummary();
    });

    function deleteRecord(index) {
      records.splice(index, 1);
      localStorage.setItem("records", JSON.stringify(records));
      updateTableAndSummary();
    }

    function groupByMonth(data) {
      const summary = {};
      data.forEach(({ date, type, amount }) => {
        const month = new Date(date).toLocaleString('default', { year: 'numeric', month: 'short' });
        if (!summary[month]) summary[month] = { income: 0, expense: 0 };
        summary[month][type] += amount;
      });
      return summary;
    }

    function updateChart() {
      const monthlyData = groupByMonth(records);
      const labels = Object.keys(monthlyData).sort((a, b) => new Date(a) - new Date(b));
      const incomeData = labels.map(m => monthlyData[m].income || 0);
      const expenseData = labels.map(m => monthlyData[m].expense || 0);
      if (chart) chart.destroy();
      chart = new Chart(chartEl, {
        type: 'line',
        data: {
          labels,
          datasets: [
            { label: 'Income', data: incomeData, borderColor: '#4caf50', tension: 0.3 },
            { label: 'Expense', data: expenseData, borderColor: '#f44336', tension: 0.3 }
          ]
        },
        options: { responsive: true, plugins: { legend: { position: 'top' } } }
      });
    }

    // ---------- Savings Section ----------
    let savings = JSON.parse(localStorage.getItem("savings")) || [];
    let categories = JSON.parse(localStorage.getItem("categories")) || [];
    const sCategory = document.getElementById("sCategory");
    const savingsList = document.getElementById("savingsList");
    const categoryList = document.getElementById("categoryList");
    const settingsPanel = document.getElementById("settingsPanel");
    let categoryChart;

    document.getElementById("savingsForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const entry = {
        date: document.getElementById("sDate").value,
        type: document.getElementById("sType").value,
        amount: parseFloat(document.getElementById("sAmount").value),
        description: document.getElementById("sDesc").value,
        category: sCategory.value
      };
      savings.push(entry);
      localStorage.setItem("savings", JSON.stringify(savings));
      this.reset();
      renderSavingsSummary();
    });

    function getCategoryTotal(name) {
      return savings
        .filter(e => e.category === name)
        .reduce((sum, e) => e.type === 'income' ? sum + e.amount : sum - e.amount, 0);
    }

    function renderSavingsSummary() {
      savingsList.innerHTML = '';
      categories.forEach(cat => {
        const total = getCategoryTotal(cat.name);
        const safeTotal = total < 0 ? 0 : total;
        const percent = safeTotal / cat.target;
        const status = percent >= 1 ? 'text-green-600' : percent >= 0.7 ? 'text-orange-500' : 'text-red-600';
        const card = document.createElement("div");
        card.className = "border rounded-lg p-4";
        card.innerHTML = `
          <div class="text-lg font-semibold mb-2">${cat.name} ${safeTotal >= cat.target ? '<span class="text-green-600 ml-2 font-bold">üéâ Achieved!</span>' : ''}</div>
          <div class="font-semibold ${status} mb-2">‚Çπ${safeTotal} / ‚Çπ${cat.target}</div>
          <div class="space-y-1 text-sm text-gray-700">
            ${savings.filter(e => e.category === cat.name).map((entry, i) => `
              <div class="flex justify-between items-center">
                ${entry.date} - ${entry.type === 'income' ? '+' : '-'}‚Çπ${entry.amount} (${entry.description})
                <button onclick="deleteSaving(${i})" class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600">X</button>
              </div>
            `).join('')}
          </div>`;
        savingsList.appendChild(card);
      });
      renderLineChart();
    }

    function deleteSaving(index) {
      savings.splice(index, 1);
      localStorage.setItem("savings", JSON.stringify(savings));
      renderSavingsSummary();
    }

    function renderCategoriesInDropdown() {
      sCategory.innerHTML = '';
      categories.forEach(cat => {
        const opt = document.createElement("option");
        opt.value = cat.name;
        opt.textContent = cat.name;
        sCategory.appendChild(opt);
      });
    }

    function addCategory() {
      const name = document.getElementById("newCategory").value.trim();
      const target = parseFloat(document.getElementById("targetAmount").value);
      if (!name || isNaN(target)) return;
      categories.push({ name, target });
      localStorage.setItem("categories", JSON.stringify(categories));
      document.getElementById("newCategory").value = '';
      document.getElementById("targetAmount").value = '';
      renderCategoriesInDropdown();
      renderCategoryList();
      renderSavingsSummary();
    }

    function renderCategoryList() {
      categoryList.innerHTML = '';
      categories.forEach((cat, i) => {
        const row = document.createElement("div");
        row.className = "flex justify-between items-center bg-gray-50 px-4 py-2 rounded";
        row.innerHTML = `
          <span>${cat.name} (‚Çπ${cat.target})</span>
          <button onclick="deleteCategory(${i})" class="text-sm bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600">Delete</button>`;
        categoryList.appendChild(row);
      });
    }

    function deleteCategory(index) {
      const name = categories[index].name;
      categories.splice(index, 1);
      savings = savings.filter(e => e.category !== name);
      localStorage.setItem("categories", JSON.stringify(categories));
      localStorage.setItem("savings", JSON.stringify(savings));
      renderCategoriesInDropdown();
      renderCategoryList();
      renderSavingsSummary();
    }

    function groupByMonthCategory() {
      const grouped = {};
      savings.forEach(({ date, amount, category, type }) => {
        const month = new Date(date).toLocaleString('default', { year: 'numeric', month: 'short' });
        if (!grouped[category]) grouped[category] = {};
        if (!grouped[category][month]) grouped[category][month] = 0;
        grouped[category][month] += type === 'income' ? amount : -amount;
      });
      return grouped;
    }

    function renderLineChart() {
      const ctx = document.getElementById("categoryChart").getContext("2d");
      const groupedData = groupByMonthCategory();
      const allMonths = [...new Set(savings.map(s => new Date(s.date).toLocaleString('default', { year: 'numeric', month: 'short' })))].sort((a, b) => new Date(a) - new Date(b));
      const datasets = categories.map((cat, i) => {
        const color = `hsl(${(i * 60) % 360}, 70%, 50%)`;
        return {
          label: cat.name,
          data: allMonths.map(m => groupedData[cat.name]?.[m] || 0),
          borderColor: color,
          backgroundColor: color + '33',
          tension: 0.3,
          fill: false
        };
      });
      if (categoryChart) categoryChart.destroy();
      categoryChart = new Chart(ctx, {
        type: 'line',
        data: { labels: allMonths, datasets },
        options: { responsive: true, plugins: { legend: { position: 'top' } } }
      });
    }

    document.getElementById("settingsBtn").addEventListener("click", () => {
      settingsPanel.classList.toggle("hidden");
    });

    // Initial load
    renderCategoriesInDropdown();
    renderCategoryList();
    renderSavingsSummary();
    updateTableAndSummary();
  </script>
</body>
</html>
